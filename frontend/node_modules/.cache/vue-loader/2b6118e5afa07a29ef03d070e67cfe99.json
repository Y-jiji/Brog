{"remainingRequest":"C:\\Users\\YangTianJi\\Desktop\\Code_Projects\\CKAS\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\YangTianJi\\Desktop\\Code_Projects\\CKAS\\frontend\\src\\views\\Reader.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\YangTianJi\\Desktop\\Code_Projects\\CKAS\\frontend\\src\\views\\Reader.vue","mtime":1627529807778},{"path":"C:\\Users\\YangTianJi\\Desktop\\Code_Projects\\CKAS\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YangTianJi\\Desktop\\Code_Projects\\CKAS\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\YangTianJi\\Desktop\\Code_Projects\\CKAS\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YangTianJi\\Desktop\\Code_Projects\\CKAS\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgKiBhcyBQREZKUyBmcm9tICdwZGZqcy1kaXN0L3dlYnBhY2snDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIlJlYWRlciIsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHV1aWQ6ICIiLA0KICAgICAgcGRmX3VybDogIiIsDQogICAgICBwZGZfZG9jOiBudWxsLA0KICAgICAgcGFnZU51bTogMCwNCiAgICB9Ow0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMudXVpZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnV1aWQ7DQogICAgdGhpcy5wZGZfdXJsID0gdGhpcy5nZXRIb3N0VXJsKCkgKyAnOjUwMDAvZmlsZS9nZXRfcGRmP2Jvb2tfaWQ9JyArIHRoaXMudXVpZDsNCiAgICB0aGlzLmxvYWRQZGYodGhpcy5wZGZfdXJsKTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGdldEhvc3RVcmwoKXsNCiAgICAgIGxldCBmdWxsX3BhdGggPSB3aW5kb3cuZG9jdW1lbnQubG9jYXRpb24uaHJlZjsNCiAgICAgIGxldCBwcm90b2NvbF9pbmRleCA9IGZ1bGxfcGF0aC5pbmRleE9mKCI6Ly8iKTsNCiAgICAgIGxldCBwcm90b2NvbF9zdHIgPSBmdWxsX3BhdGguc3Vic3RyaW5nKDAsIHByb3RvY29sX2luZGV4KTsNCiAgICAgIGxldCBmdWxsX3BhdGhfc3RyaXBwZWQgPSBmdWxsX3BhdGguc3Vic3RyaW5nKHByb3RvY29sX2luZGV4ICsgMyk7DQogICAgICBsZXQgcm91dGVyX3BhdGggPSAgdGhpcy4kcm91dGUucGF0aDsNCiAgICAgIGxldCBob3N0X2luZGV4ID0gZnVsbF9wYXRoX3N0cmlwcGVkLmluZGV4T2Yocm91dGVyX3BhdGgpOw0KICAgICAgbGV0IGZ1bGxfaG9zdCA9IGZ1bGxfcGF0aF9zdHJpcHBlZC5zdWJzdHJpbmcoMCwgaG9zdF9pbmRleCk7DQogICAgICBjb25zb2xlLmxvZyhmdWxsX3BhdGgpOw0KICAgICAgbGV0IHByZWRfaW5kZXggPSBmdWxsX2hvc3QubGFzdEluZGV4T2YoIjoiKTsNCiAgICAgIGxldCBwdXJlX2hvc3QgPSBmdWxsX2hvc3Quc3Vic3RyaW5nKDAsIHByZWRfaW5kZXgpOw0KICAgICAgcmV0dXJuIHByb3RvY29sX3N0ciArICI6Ly8iICsgcHVyZV9ob3N0Ow0KICAgIH0sDQogICAgbG9hZFBkZihwZGZfdXJsKXsNCiAgICAgIGxldCB0aGF0ID0gdGhpczsNCiAgICAgIFBERkpTLmdldERvY3VtZW50KHBkZl91cmwpLnByb21pc2UudGhlbigocGRmKSA9PiB7DQogICAgICAgIHRoYXQucGRmX2RvYyA9IHBkZjsNCiAgICAgICAgdGhhdC5wYWdlTnVtID0gcGRmLm51bVBhZ2VzOw0KICAgICAgICB0aGF0LiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgdGhhdC5yZW5kZXJQYWdlKDEpOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgcmVuZGVyUGFnZShwYWdlX251bSl7DQogICAgICBsZXQgdGhhdCA9IHRoaXM7DQogICAgICB0aGlzLnBkZl9kb2MuZ2V0UGFnZShwYWdlX251bSkudGhlbigocGFnZSkgPT4gew0KICAgICAgICB2YXIgc2NhbGUgPSAxLjUNCiAgICAgICAgdmFyIHZpZXdwb3J0ID0gcGFnZS5nZXRWaWV3cG9ydCh7c2NhbGU6IHNjYWxlfSk7DQogICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJyArIHBhZ2VfbnVtKTsNCiAgICAgICAgdmFyIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgY2FudmFzLmhlaWdodCA9IHZpZXdwb3J0LmhlaWdodDsNCiAgICAgICAgY2FudmFzLndpZHRoID0gdmlld3BvcnQud2lkdGg7DQogICAgICAgIHZhciByZW5kZXJDb250ZXh0ID0gew0KICAgICAgICAgIGNhbnZhc0NvbnRleHQ6IGNvbnRleHQsDQogICAgICAgICAgdmlld3BvcnQ6IHZpZXdwb3J0LA0KICAgICAgICB9DQogICAgICAgIHBhZ2UucmVuZGVyKHJlbmRlckNvbnRleHQpOw0KICAgICAgICBjb25zb2xlLmxvZyhwYWdlX251bSkNCg0KICAgICAgICBpZiAodGhhdC5wYWdlTnVtID4gcGFnZV9udW0pIHsNCiAgICAgICAgICB0aGF0LnJlbmRlclBhZ2UocGFnZV9udW0gKyAxKQ0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["Reader.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAcA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Reader.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"row\">\r\n    <div ref=\"main_reader\">\r\n      <b-card no-body class=\"col-6\">\r\n              <canvas v-for=\"page in pageNum\" :id=\"'canvas' + page\" :key=\"page\"></canvas>\r\n      </b-card>\r\n    </div>\r\n    <div ref=\"ref_reader\">\r\n      \r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as PDFJS from 'pdfjs-dist/webpack'\r\n\r\nexport default {\r\n  name: \"Reader\",\r\n  data() {\r\n    return {\r\n      uuid: \"\",\r\n      pdf_url: \"\",\r\n      pdf_doc: null,\r\n      pageNum: 0,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.uuid = this.$route.query.uuid;\r\n    this.pdf_url = this.getHostUrl() + ':5000/file/get_pdf?book_id=' + this.uuid;\r\n    this.loadPdf(this.pdf_url);\r\n  },\r\n  methods: {\r\n    getHostUrl(){\r\n      let full_path = window.document.location.href;\r\n      let protocol_index = full_path.indexOf(\"://\");\r\n      let protocol_str = full_path.substring(0, protocol_index);\r\n      let full_path_stripped = full_path.substring(protocol_index + 3);\r\n      let router_path =  this.$route.path;\r\n      let host_index = full_path_stripped.indexOf(router_path);\r\n      let full_host = full_path_stripped.substring(0, host_index);\r\n      console.log(full_path);\r\n      let pred_index = full_host.lastIndexOf(\":\");\r\n      let pure_host = full_host.substring(0, pred_index);\r\n      return protocol_str + \"://\" + pure_host;\r\n    },\r\n    loadPdf(pdf_url){\r\n      let that = this;\r\n      PDFJS.getDocument(pdf_url).promise.then((pdf) => {\r\n        that.pdf_doc = pdf;\r\n        that.pageNum = pdf.numPages;\r\n        that.$nextTick(() => {\r\n          that.renderPage(1);\r\n        });\r\n      });\r\n    },\r\n    renderPage(page_num){\r\n      let that = this;\r\n      this.pdf_doc.getPage(page_num).then((page) => {\r\n        var scale = 1.5\r\n        var viewport = page.getViewport({scale: scale});\r\n        var canvas = document.getElementById('canvas' + page_num);\r\n        var context = canvas.getContext('2d');\r\n        canvas.height = viewport.height;\r\n        canvas.width = viewport.width;\r\n        var renderContext = {\r\n          canvasContext: context,\r\n          viewport: viewport,\r\n        }\r\n        page.render(renderContext);\r\n        console.log(page_num)\r\n\r\n        if (that.pageNum > page_num) {\r\n          that.renderPage(page_num + 1)\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}